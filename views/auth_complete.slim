doctype html
html
  head
    title Qiita contribution
    script src="js/d3/d3.min.js"

  body
    h1 Qiita contribution
    css:
      body {
        font: 10px sans-serif;
      }
      .days {
        fill: rgb(238, 238, 238);
      }
      .days:hover {
        stroke: rgb(0, 0, 0);
      }

      .level-1 {
        fill: #d6e685
      }

      .level-2 {
        fill: #8cc665
      }

      .level-3 {
        fill: #44a340
      }

      .level-4 {
        fill: #1e6823
      }

      .day_label {
        font-family: sans-serif;
        font-size: 8px;
        fill: #cccccc;
        text-anchor: middle;
        width: 11px;
        height: 11px;
      }
      #tooltip {
        background-color: #000;
        opacity: 0.7;
        position: absolute;
        color: #fff;
        padding: 10px;
        border-radius: 3px;
        text-align: center;
        font-size: 11px;
      }
      #tooltip:after {
        box-sizing: border-box;
        position: absolute;
        left: 50%;
        height: 5px;
        width: 5px;
        bottom: -10px;
        margin: 0 0 0 -5px;
        content: " ";
        border: 5px solid transparent;
        border-top-color: #000;

      }


    javascript:

      var width = 960,
              height = 136,
              cellSize = 11,
              format = d3.time.format("%Y-%m-%d");

      var barPadding = 1;
      var datasetDays = d3.time.days(new Date(2014, 7, 22), new Date(2015, 7, 22));
      var dataSetMonths = d3.time.months(new Date(2014, 7, 1), new Date(2015, 8, 1));
      var startDay = new Date(2014, 7, 22);

      var svg = d3.select("body")
              .append("svg")
              .attr("width", width)
              .attr("height", height);

      var rect = svg.selectAll("rect")
              .data(datasetDays)
              .enter()
              .append("rect")
              .attr("x", function (d, i) {
                var tmpI = i + startDay.getDay();
                var col = Math.floor(tmpI / 7);
                return col * cellSize + col * 2 + 15;
              })
              .attr("y", function (d, i) {
                var row = d.getDay();
                return row * cellSize + row * 2 + 15;
              })
              .attr("width", cellSize)
              .attr("height", cellSize)
              .attr("class", 'days')
              .on("mouseover", function(d) {
                var format = d3.time.format("%b %d, %Y");
                var x = parseInt(this.getAttribute('x'), 10) - 78;
                var y = parseInt(this.getAttribute('y'), 10) + 10;
                var tooltip = d3.select("body")
                        .append("div")
                        .attr("id", "tooltip")
                        .html("<strong>8 contributions</strong> " + format(new Date(d)))
                        .attr("style", "top:" + y + "px;left:" + x + "px;");
              })
              .on("mouseout", function () {
                d3.select("#tooltip").remove();
              })
              .datum(format);

      rect.append("title")
              .text(function (d) {
                return d;
              });

      d3.csv("test.csv", function (error, csv) {
        if (error) throw error;

        var data = d3.nest()
                .key(function (d) {
                  return d.Date;
                })
                .map(csv);

        rect.filter(function (d) {
          return d in data;
        })
                .attr("class", function (d) {
                  var point = data[d][0].Post * 1;
                  colorId = 0;
                  if (point > 5) {
                    colorId = 4;
                  } else if (point > 2) {
                    colorId = 3;
                  } else if (point > 1) {
                    colorId = 2;
                  } else if (point > 0) {
                    colorId = 1;
                  }
                  console.log(point);
                  return "days level-" + colorId;
                });
      });

      svg.selectAll("text")
              .data(dataSetMonths)
              .enter()
              .append("text")
              .attr("x", function(d, i) {
                return (i + 1) * 52
              })
              .attr("y", 10)
              .attr("class", "day_label")
              .text(function(d) {
                console.log(d);
                var format = d3.time.format("%b");
                return format(d);
              })
              .datum(d3.time.format("%b"));

      svg.append("text")
              .attr("x", 5)
              .attr("y", 36)
              .attr("class", 'day_label')
              .text("M");
      svg.append("text")
              .attr("x", 5)
              .attr("y", 63)
              .attr("class", 'day_label')
              .text("W");
      svg.append("text")
              .attr("x", 5)
              .attr("y", 89)
              .attr("class", 'day_label')
              .text("F");